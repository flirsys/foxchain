<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–æ–¥–æ–π</title>
  <style>
    :root {
      --bg: #121313;
      --block-bg: #1f2020;
      --input-bg: #2a2f2f;
      --primary: #475e52;
      --secondary: #7b6240;
      --text: #ffffff;
      --text-muted: #9d9d9e;
      --accent: #5555ff;
      --error: #e74c3c;
      --success: #2ecc71;
    }
    * {
      box-sizing: border-box; margin: 0; padding: 0; border: 0;
      font-family: "Helvetica", sans-serif; letter-spacing: -0.5px;
      transition: all 0.15s ease; user-select: none; -webkit-user-select: none;
      appearance: none; outline: none;
    }
    html, body {
      background-color: var(--bg); color: var(--text); font-size: 16px;
      -webkit-text-size-adjust: none; scroll-behavior: smooth;
    }
    body { width: 100%; padding: 1rem; }
    @media (min-width: 960px) {
      body { width: 80%; margin: 0 auto; }
    }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1rem; }
    .block {
      width: 100%; background: var(--block-bg); border: 1px solid #343330;
      border-radius: 8px; padding: 1rem; margin-top: 1rem;
    }
    .block.full-width { grid-column: 1 / -1; }
    .block-header {
      font-size: 22px; font-weight: bold; color: var(--text);
      border-bottom: 2px solid var(--primary); padding-bottom: 0.5rem; margin-bottom: 1rem;
    }
    label { display: block; color: var(--text-muted); margin-top: 1rem; margin-bottom: 0.5rem; }
    input, button {
      background: var(--input-bg); color: var(--text); border-radius: 6px;
      font-size: 16px; padding: 10px; width: 100%;
    }
    button {
      background: var(--primary); cursor: pointer; font-weight: bold;
      margin-top: 1rem;
    }
    button:hover { background: #5a7968; }
    pre {
      background: #0e0e0e; padding: 1rem; border-radius: 6px;
      overflow-x: auto; white-space: pre-wrap; word-break: break-all;
      font-family: monospace; max-height: 250px; border-left: 4px solid var(--secondary);
    }
    .toast {
      position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%);
      background: #2a2f2f; padding: 1rem 1.5rem; border-radius: 8px;
      border-top: 4px solid; box-shadow: 0 5px 15px rgba(0,0,0,0.4);
      z-index: 1000; transition: bottom 0.5s ease;
    }
    .toast.show { bottom: 20px; }
    .toast.success { border-color: var(--success); color: var(--success); }
    .toast.error { border-color: var(--error); color: var(--error); }
    .toast.info { border-color: var(--accent); color: var(--accent); }
  </style>
</head>
<body>
  <div class="grid">
    <div class="block full-width">
      <div class="block-header">‚ÑπÔ∏è –°—Ç–∞—Ç—É—Å –Ω–æ–¥—ã</div>
      <pre id="nodeInfo">–ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å", —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å...</pre>
      <button onclick="getNodeInfo()">–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
    </div>
    
    <div class="block">
      <div class="block-header">‚õèÔ∏è –ú–∞–π–Ω–∏–Ω–≥</div>
      <button onclick="mineBlock()">–ù–∞—á–∞—Ç—å –º–∞–π–Ω–∏–Ω–≥ –±–ª–æ–∫–∞</button>
      <pre id="mineResult">–û–∂–∏–¥–∞–Ω–∏–µ...</pre>
    </div>
    
    <div class="block">
      <div class="block-header">üí∏ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç –∏–º–µ–Ω–∏ –Ω–æ–¥—ã</div>
      <label for="txRecipient">–ê–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è</label>
      <input type="text" id="txRecipient" placeholder="fox...">
      <label for="txAmount">–°—É–º–º–∞</label>
      <input type="number" id="txAmount" placeholder="0.0">
      <button onclick="sendTxFromNode()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
    
    <div class="block full-width">
      <div class="block-header">‚è≥ –ü—É–ª –æ–∂–∏–¥–∞—é—â–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</div>
      <pre id="pendingResult">[]</pre>
      <button onclick="getPending()">–û–±–Ω–æ–≤–∏—Ç—å –ø—É–ª</button>
    </div>
    
    <div class="block full-width">
      <div class="block-header">üîó –ü—Ä–æ—Å–º–æ—Ç—Ä –±–ª–æ–∫—á–µ–π–Ω–∞</div>
      <button onclick="getLatestBlock()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–ª–æ–∫</button>
      <label for="blockNumber">–ò–ª–∏ –Ω–∞–π—Ç–∏ –ø–æ –Ω–æ–º–µ—Ä—É:</label>
      <input type="number" id="blockNumber" placeholder="–ù–æ–º–µ—Ä –±–ª–æ–∫–∞">
      <button onclick="getBlockByNumber()">–ù–∞–π—Ç–∏ –±–ª–æ–∫</button>
      <pre id="blockResult">–ó–¥–µ—Å—å –±—É–¥–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–ª–æ–∫–µ...</pre>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        getNodeInfo();
        getPending();
    });

    function showToast(message, type = "success") {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.className = `toast ${type} show`;
        setTimeout(() => { toast.className = 'toast'; }, 3500);
    }
    
    async function getNodeInfo() {
        const res = await fetch('/api/account/node');
        const data = await res.json();
        document.getElementById('nodeInfo').innerText = data.error ? data.error : JSON.stringify(data, null, 2);
    }

    async function sendTxFromNode() {
        const recipient = document.getElementById('txRecipient').value.trim();
        const value = parseFloat(document.getElementById('txAmount').value);
        if (!recipient || isNaN(value) || value <= 0) {
            showToast('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–¥—Ä–µ—Å –∏ —Å—É–º–º—É!', 'error');
            return;
        }
        showToast('–û—Ç–ø—Ä–∞–≤–∫–∞...', 'info');
        const nodeInfoRes = await fetch('/api/account/node');
        const nodeInfo = await nodeInfoRes.json();
        if (nodeInfo.error) {
            showToast(`–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–æ–¥—ã: ${nodeInfo.error}`, 'error');
            return;
        }

        const res = await fetch('/api/tx/send', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                sender: nodeInfo.address, recipient, value, nonce: nodeInfo.nonce,
                signature: 'node', publicKey: 'node'
            })
        });

        const data = await res.json();
        if (data.success) {
            showToast('–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç –Ω–æ–¥—ã —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!', 'success');
            document.getElementById('txRecipient').value = '';
            document.getElementById('txAmount').value = '';
            setTimeout(() => { getNodeInfo(); getPending(); }, 1000);
        } else {
            showToast(`–û—à–∏–±–∫–∞: ${data.message}`, 'error');
        }
    }

    async function mineBlock() {
        showToast('–ù–∞—á–∏–Ω–∞—é –º–∞–π–Ω–∏–Ω–≥...', 'info');
        const res = await fetch('/api/mine', {method: 'POST'});
        const data = await res.json();
        document.getElementById('mineResult').innerText = data.error ? data.error : JSON.stringify(data, null, 2);
        if(data.success) {
            showToast('–ù–æ–≤—ã–π –±–ª–æ–∫ —É—Å–ø–µ—à–Ω–æ —Å–º–∞–π–Ω–µ–Ω!', 'success');
        } else {
            showToast(`–û—à–∏–±–∫–∞ –º–∞–π–Ω–∏–Ω–≥–∞: ${data.message || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
        }
        setTimeout(() => { getNodeInfo(); getPending(); }, 500);
    }

    async function getPending() {
        const res = await fetch('/api/tx/pending');
        const data = await res.json();
        document.getElementById('pendingResult').innerText = JSON.stringify(data, null, 2);
    }
    
    async function getLatestBlock() {
        const res = await fetch('/api/block/latest');
        const data = await res.json();
        document.getElementById('blockResult').innerText = data.error ? data.error : JSON.stringify(data, null, 2);
    }

    async function getBlockByNumber() {
        const num = document.getElementById('blockNumber').value;
        if (!num || num < 0) {
            showToast('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä –±–ª–æ–∫–∞', 'error');
            return;
        }
        const res = await fetch(`/api/block/${num}`);
        const data = await res.json();
        document.getElementById('blockResult').innerText = data.error ? data.error : JSON.stringify(data, null, 2);
    }
  </script>
</body>
</html>